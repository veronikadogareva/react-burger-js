{"ast":null,"code":"const BASEURL = \"https://norma.nomoreparties.space/api\";\nexport default class BaseService {\n  static async checkResponse(res) {\n    const data = await res.json();\n    return res.ok ? data : Promise.reject(data);\n  }\n  static async refreshToken() {\n    const res = await fetch(`${BASEURL}/auth/token`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json;charset=utf-8\"\n      },\n      body: JSON.stringify({\n        token: localStorage.getItem(\"refreshToken\")\n      })\n    });\n    const refreshData = await this.checkResponse(res);\n    if (!refreshData.success) {\n      return Promise.reject(refreshData);\n    }\n    localStorage.setItem(\"accessToken\", refreshData.accessToken);\n    localStorage.setItem(\"refreshToken\", refreshData.refreshToken);\n    return refreshData;\n  }\n  static async sendRequest(url, options = {}) {\n    const fullUrl = BASEURL + url;\n    const accessToken = localStorage.getItem('accessToken');\n    if (accessToken) {\n      options.headers = {\n        ...options.headers,\n        Authorization: accessToken\n      };\n    }\n    try {\n      const res = await fetch(fullUrl, options);\n      return await this.checkResponse(res);\n    } catch (err) {\n      if (err.message === \"jwt expired\") {\n        const refreshData = await this.refreshToken();\n        options.headers = {\n          ...options.headers,\n          Authorization: refreshData.accessToken\n        };\n        const res = await fetch(fullUrl, options);\n        return await this.checkResponse(res);\n      } else {\n        console.error('Ошибка запроса:', err);\n        throw err;\n      }\n    }\n  }\n  static getIngredients() {\n    const url = \"/ingredients\";\n    return this.sendRequest(url);\n  }\n  static sendOrder(orderData) {\n    const url = \"/orders\";\n    return this.sendRequest(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(orderData)\n    });\n  }\n}","map":{"version":3,"names":["BASEURL","BaseService","checkResponse","res","data","json","ok","Promise","reject","refreshToken","fetch","method","headers","body","JSON","stringify","token","localStorage","getItem","refreshData","success","setItem","accessToken","sendRequest","url","options","fullUrl","Authorization","err","message","console","error","getIngredients","sendOrder","orderData"],"sources":["C:/Users/dogareva/Documents/GitHub/react-burger-js/src/utils/BaseService.jsx"],"sourcesContent":["const BASEURL = \"https://norma.nomoreparties.space/api\";\r\n\r\nexport default class BaseService {\r\n  static async checkResponse(res) {\r\n    const data = await res.json();\r\n    return res.ok ? data : Promise.reject(data);\r\n  }\r\n  static async refreshToken() {\r\n    const res = await fetch(`${BASEURL}/auth/token`, {\r\n      method:\"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json;charset=utf-8\",\r\n      },\r\n      body:JSON.stringify({\r\n        token:localStorage.getItem(\"refreshToken\")\r\n      }),\r\n    });\r\n    const refreshData = await this.checkResponse(res);\r\n    if (!refreshData.success) {\r\n      return Promise.reject(refreshData);\r\n    }\r\n    localStorage.setItem(\"accessToken\", refreshData.accessToken);\r\n    localStorage.setItem(\"refreshToken\", refreshData.refreshToken);\r\n\r\n    return refreshData;\r\n  }\r\n  static async sendRequest(url, options = {}) {\r\n    const fullUrl = BASEURL + url;\r\n    const accessToken = localStorage.getItem('accessToken');\r\n    if (accessToken) {\r\n      options.headers = {\r\n        ...options.headers,\r\n        Authorization: accessToken,\r\n      }\r\n    }\r\n    try {\r\n      const res = await fetch(fullUrl, options);\r\n      return await this.checkResponse(res);\r\n    } catch(err) {\r\n      if (err.message === \"jwt expired\") {\r\n        const refreshData = await this.refreshToken();\r\n\r\n        options.headers = {\r\n          ...options.headers,\r\n          Authorization:refreshData.accessToken,\r\n        };\r\n        const res = await fetch(fullUrl, options);\r\n        return await this.checkResponse(res);\r\n      } else {\r\n        console.error('Ошибка запроса:', err);\r\n        throw err;\r\n      }\r\n    }\r\n  }\r\n  static getIngredients() {\r\n    const url = \"/ingredients\";\r\n    return this.sendRequest(url);\r\n  }\r\n  static sendOrder(orderData) {\r\n    const url = \"/orders\";\r\n    return this.sendRequest(url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(orderData),\r\n    });\r\n  }\r\n}\r\n"],"mappings":"AAAA,MAAMA,OAAO,GAAG,uCAAuC;AAEvD,eAAe,MAAMC,WAAW,CAAC;EAC/B,aAAaC,aAAaA,CAACC,GAAG,EAAE;IAC9B,MAAMC,IAAI,GAAG,MAAMD,GAAG,CAACE,IAAI,CAAC,CAAC;IAC7B,OAAOF,GAAG,CAACG,EAAE,GAAGF,IAAI,GAAGG,OAAO,CAACC,MAAM,CAACJ,IAAI,CAAC;EAC7C;EACA,aAAaK,YAAYA,CAAA,EAAG;IAC1B,MAAMN,GAAG,GAAG,MAAMO,KAAK,CAAC,GAAGV,OAAO,aAAa,EAAE;MAC/CW,MAAM,EAAC,MAAM;MACbC,OAAO,EAAE;QACP,cAAc,EAAE;MAClB,CAAC;MACDC,IAAI,EAACC,IAAI,CAACC,SAAS,CAAC;QAClBC,KAAK,EAACC,YAAY,CAACC,OAAO,CAAC,cAAc;MAC3C,CAAC;IACH,CAAC,CAAC;IACF,MAAMC,WAAW,GAAG,MAAM,IAAI,CAACjB,aAAa,CAACC,GAAG,CAAC;IACjD,IAAI,CAACgB,WAAW,CAACC,OAAO,EAAE;MACxB,OAAOb,OAAO,CAACC,MAAM,CAACW,WAAW,CAAC;IACpC;IACAF,YAAY,CAACI,OAAO,CAAC,aAAa,EAAEF,WAAW,CAACG,WAAW,CAAC;IAC5DL,YAAY,CAACI,OAAO,CAAC,cAAc,EAAEF,WAAW,CAACV,YAAY,CAAC;IAE9D,OAAOU,WAAW;EACpB;EACA,aAAaI,WAAWA,CAACC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;IAC1C,MAAMC,OAAO,GAAG1B,OAAO,GAAGwB,GAAG;IAC7B,MAAMF,WAAW,GAAGL,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;IACvD,IAAII,WAAW,EAAE;MACfG,OAAO,CAACb,OAAO,GAAG;QAChB,GAAGa,OAAO,CAACb,OAAO;QAClBe,aAAa,EAAEL;MACjB,CAAC;IACH;IACA,IAAI;MACF,MAAMnB,GAAG,GAAG,MAAMO,KAAK,CAACgB,OAAO,EAAED,OAAO,CAAC;MACzC,OAAO,MAAM,IAAI,CAACvB,aAAa,CAACC,GAAG,CAAC;IACtC,CAAC,CAAC,OAAMyB,GAAG,EAAE;MACX,IAAIA,GAAG,CAACC,OAAO,KAAK,aAAa,EAAE;QACjC,MAAMV,WAAW,GAAG,MAAM,IAAI,CAACV,YAAY,CAAC,CAAC;QAE7CgB,OAAO,CAACb,OAAO,GAAG;UAChB,GAAGa,OAAO,CAACb,OAAO;UAClBe,aAAa,EAACR,WAAW,CAACG;QAC5B,CAAC;QACD,MAAMnB,GAAG,GAAG,MAAMO,KAAK,CAACgB,OAAO,EAAED,OAAO,CAAC;QACzC,OAAO,MAAM,IAAI,CAACvB,aAAa,CAACC,GAAG,CAAC;MACtC,CAAC,MAAM;QACL2B,OAAO,CAACC,KAAK,CAAC,iBAAiB,EAAEH,GAAG,CAAC;QACrC,MAAMA,GAAG;MACX;IACF;EACF;EACA,OAAOI,cAAcA,CAAA,EAAG;IACtB,MAAMR,GAAG,GAAG,cAAc;IAC1B,OAAO,IAAI,CAACD,WAAW,CAACC,GAAG,CAAC;EAC9B;EACA,OAAOS,SAASA,CAACC,SAAS,EAAE;IAC1B,MAAMV,GAAG,GAAG,SAAS;IACrB,OAAO,IAAI,CAACD,WAAW,CAACC,GAAG,EAAE;MAC3Bb,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACP,cAAc,EAAE;MAClB,CAAC;MACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACmB,SAAS;IAChC,CAAC,CAAC;EACJ;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}